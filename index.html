<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema √önico SST</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f4f6f8;}
header{text-align:center;padding:20px;background:#003366;color:#fff;border-radius:12px;}
h1{margin:0;font-size:22px;}

.btn{
  width:100%;padding:14px;margin:10px 0;
  border:none;border-radius:12px;
  background:#0059b3;color:white;
  font-size:16px;font-weight:bold;
}

.save{background:green;}
.pdf{background:darkred;}
.whats{background:#25D366;}
.back{background:gray;}

section{
  display:none;
  background:white;
  padding:15px;
  margin-top:15px;
  border-radius:12px;
}

input,textarea,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px;
}

canvas{
  width:100%;
  height:140px;
  border:2px solid black;
  border-radius:10px;
  background:white;
  touch-action:none;
}

hr{margin:20px 0;}
h3{margin-top:25px;}
small{color:#444;}
</style>
</head>

<body>

<header>
<h1>Sistema √önico SST</h1>
<p><b>FREIBERGER & FERNANDES ‚Äì Engenharia</b></p>
<p>Padr√£o Fiscaliza√ß√£o Oficial</p>
</header>

<!-- MENU -->
<section id="menu" style="display:block;">
<button class="btn" onclick="abrir('nr35')">üìã NR35 ‚Äì Autoriza√ß√£o Trabalho em Altura</button>
<button class="btn" onclick="abrir('nr18')">ü¶∫ NR18 ‚Äì Checklist Fiscaliza√ß√£o</button>
<button class="btn" onclick="abrir('historico')">üìÇ Hist√≥rico</button>
</section>

<!-- ======================= NR35 COMPLETA ======================= -->
<section id="nr35">
<h2>üìã NR35 ‚Äì Autoriza√ß√£o Trabalho em Altura</h2>

<label>Local da Obra:</label>
<input id="local35">

<label>Respons√°vel Empresa:</label>
<input id="empresa35">

<label>Engenheiro Respons√°vel:</label>
<input id="eng35" value="Eng. Jadison Fernandes">

<hr>

<h3>Capacita√ß√£o / Riscos Gerais</h3>
<div id="checklist35"></div>

<hr>

<h3>Trabalhadores Autorizados (5)</h3>
<div id="listaTrabalhadores"></div>

<button class="btn save" onclick="salvarNR35()">üíæ Salvar NR35</button>
<button class="btn pdf" onclick="gerarPDF_NR35()">üìÑ Gerar PDF Oficial NR35</button>
<button class="btn whats" onclick="enviarWhats()">üì≤ Enviar WhatsApp Engenheiro</button>
<button class="btn back" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<!-- ======================= NR18 ======================= -->
<section id="nr18">
<h2>ü¶∫ NR18 ‚Äì Checklist Fiscaliza√ß√£o</h2>

<label>Obra:</label>
<input id="obra18">

<label>Respons√°vel:</label>
<input id="resp18">

<hr>

<h3>1Ô∏è‚É£ EPI</h3>
<div id="epi18"></div>

<h3>2Ô∏è‚É£ EPC</h3>
<div id="epc18"></div>

<h3>3Ô∏è‚É£ Sinaliza√ß√£o</h3>
<div id="sig18"></div>

<h3>4Ô∏è‚É£ M√°quinas e Circula√ß√£o</h3>
<div id="maq18"></div>

<hr>

<h3>Conclus√£o</h3>
<textarea id="obs18" placeholder="Observa√ß√µes"></textarea>

<button class="btn save" onclick="salvarNR18()">üíæ Salvar NR18</button>
<button class="btn pdf" onclick="gerarPDF_NR18()">üìÑ Gerar PDF Oficial NR18</button>
<button class="btn back" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<!-- ======================= HIST√ìRICO ======================= -->
<section id="historico">
<h2>üìÇ Hist√≥rico</h2>
<div id="lista"></div>
<button class="btn back" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<script>
let pads=[];

/* ================= MENU ================= */
function abrir(id){
  document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";

  if(id==="nr35"){
    montarChecklistNR35();
    carregarTrabalhadores();
  }

  if(id==="nr18"){
    montarNR18();
  }

  if(id==="historico") carregarHistorico();
}

/* ================= NR35 CHECKLIST ================= */
function montarChecklistNR35(){
  let itens=[
    "Funcion√°rio treinado na atividade?",
    "Exame m√©dico OK?",
    "Risco de contato com partes energizadas?",
    "Tempo seco e sem vento forte?",
    "Existe risco de queda de objetos?",
    "√Årea de trabalho isolada?",
    "Local seguro para fixa√ß√£o do cinto?"
  ];

  let html="";
  itens.forEach((t,i)=>{
    html+=`
      <label>${t}
      <select id="g${i}">
        <option>SIM</option>
        <option>N√ÉO</option>
        <option>N/A</option>
      </select></label><br>`;
  });

  document.getElementById("checklist35").innerHTML=html;
}

/* ================= 5 TRABALHADORES ================= */
function carregarTrabalhadores(){
  let div=document.getElementById("listaTrabalhadores");
  div.innerHTML="";
  pads=[];

  for(let i=1;i<=5;i++){
    div.innerHTML+=`
      <h4>Trabalhador ${i}</h4>
      <input id="nome${i}" placeholder="Nome completo">
      <input id="cpf${i}" placeholder="CPF obrigat√≥rio">

      <small>Assinatura Digital:</small>
      <canvas id="canvas${i}"></canvas>

      <button class="btn back" onclick="limparCanvas(${i})">Limpar Assinatura</button>
      <hr>
    `;
  }

  setTimeout(()=>{
    for(let i=1;i<=5;i++){
      let canvas=document.getElementById("canvas"+i);
      canvas.width=canvas.offsetWidth;
      canvas.height=140;
      iniciarAssinatura(canvas,i);
    }
  },300);
}

/* ================= ASSINATURA TOUCH ================= */
function iniciarAssinatura(canvas,i){
  let ctx=canvas.getContext("2d");
  let desenhando=false;

  canvas.addEventListener("pointerdown",e=>{
    desenhando=true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX,e.offsetY);
  });

  canvas.addEventListener("pointermove",e=>{
    if(!desenhando) return;
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
  });

  canvas.addEventListener("pointerup",()=>desenhando=false);

  pads[i]={canvas,ctx};
}

function limparCanvas(i){
  pads[i].ctx.clearRect(0,0,pads[i].canvas.width,pads[i].canvas.height);
}

/* ================= NR18 CHECKLIST ================= */
function montarNR18(){
  montarLista("epi18",[
    "Capacete",
    "Botas com biqueira",
    "Luvas adequadas",
    "√ìculos de prote√ß√£o",
    "Protetor auricular",
    "M√°scara/respirador",
    "Cintur√£o de seguran√ßa",
    "EPI em bom estado",
    "CA v√°lido"
  ]);

  montarLista("epc18",[
    "Guarda-corpos instalados",
    "Rodap√©s em √°reas elevadas",
    "Escadas/rampas seguras",
    "Isolamento de √°reas de risco",
    "Prote√ß√£o em aberturas",
    "Prote√ß√µes em m√°quinas",
    "EPC em bom estado"
  ]);

  montarLista("sig18",[
    "Placas obrigat√≥rias de EPI",
    "Sinaliza√ß√£o √°reas restritas",
    "Avisos de risco",
    "Cones/barreiras isolamento",
    "Sinaliza√ß√£o vis√≠vel"
  ]);

  montarLista("maq18",[
    "Vias de circula√ß√£o definidas",
    "Separa√ß√£o pedestres/m√°quinas",
    "Piso sem obst√°culos",
    "Operadores habilitados",
    "M√°quinas com manuten√ß√£o",
    "Alarme de r√© funcionando",
    "Ilumina√ß√£o adequada",
    "Velocidade controlada"
  ]);
}

function montarLista(id,itens){
  let html="";
  itens.forEach((t,i)=>{
    html+=`
      <label>${t}
      <select>
        <option>SIM</option>
        <option>N√ÉO</option>
      </select></label><br>`;
  });
  document.getElementById(id).innerHTML=html;
}

/* ================= SALVAR ================= */
function salvarNR35(){
  for(let i=1;i<=5;i++){
    if(document.getElementById("cpf"+i).value.trim()===""){
      alert("‚ö†Ô∏è CPF obrigat√≥rio no trabalhador "+i);
      return;
    }
  }

  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR35",data:new Date().toLocaleString()});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("‚úÖ NR35 salva!");
}

function salvarNR18(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR18",data:new Date().toLocaleString()});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("‚úÖ NR18 salva!");
}

/* ================= HIST√ìRICO ================= */
function carregarHistorico(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  lista.innerHTML=dados.map(r=>`<p>‚úÖ ${r.tipo} ‚Äì ${r.data}</p>`).join("");
}

/* ================= PDF NR35 ================= */
function gerarPDF_NR35(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  doc.setFontSize(14);
  doc.text("NR35 ‚Äì AUTORIZA√á√ÉO TRABALHO EM ALTURA",10,15);

  doc.setFontSize(11);
  doc.text("Local: "+local35.value,10,25);
  doc.text("Empresa: "+empresa35.value,10,32);

  let y=45;
  for(let i=1;i<=5;i++){
    doc.text("Trabalhador "+i+": "+document.getElementById("nome"+i).value,10,y);
    doc.text("CPF: "+document.getElementById("cpf"+i).value,10,y+7);

    let img=pads[i].canvas.toDataURL("image/png");
    doc.addImage(img,"PNG",120,y-2,70,20);

    y+=25;
  }

  doc.save("NR35_Oficial.pdf");
}

/* ================= PDF NR18 ================= */
function gerarPDF_NR18(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  doc.setFontSize(14);
  doc.text("NR18 ‚Äì CHECKLIST FISCALIZA√á√ÉO",10,15);

  doc.setFontSize(11);
  doc.text("Obra: "+obra18.value,10,25);
  doc.text("Respons√°vel: "+resp18.value,10,32);

  doc.text("Observa√ß√µes:",10,50);
  doc.text(obs18.value,10,60);

  doc.save("NR18_Oficial.pdf");
}

/* ================= WHATSAPP ================= */
function enviarWhats(){
  let msg="NR35 preenchida ‚Äì Local: "+local35.value+
          " Empresa: "+empresa35.value;
  window.open("https://wa.me/5547988837699?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
