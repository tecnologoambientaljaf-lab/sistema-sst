<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema √önico SST ‚Äì Profissional</title>

<!-- Assinatura -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f4f6f8;}
header{text-align:center;padding:20px;background:#003366;color:#fff;border-radius:12px;}
h1{margin:0;font-size:22px;}
.btn{
  width:100%;padding:14px;margin:10px 0;
  border:none;border-radius:10px;
  background:#0059b3;color:white;
  font-size:16px;font-weight:bold;
}
.save{background:green;}
.pdf{background:darkred;}
.gray{background:#666;}

section{
  display:none;
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-top:15px;
}

input,textarea,select{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:4px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  border:1px solid #aaa;
  padding:6px;
  font-size:13px;
}

th{background:#e8eef5;}

canvas{
  width:100%;
  height:150px;
  border:2px solid black;
  border-radius:10px;
  background:white;
  touch-action:none;
}

.small{font-size:12px;color:#444;}
</style>
</head>

<body>

<header>
<h1>Sistema √önico SST</h1>
<p><b>FREIBERGER & FERNANDES ‚Äì Engenharia</b></p>
<p>Padr√£o Fiscaliza√ß√£o Oficial</p>
</header>

<!-- MENU -->
<section id="menu" style="display:block;">
<h2>Menu Principal</h2>

<button class="btn" onclick="abrir('nr35')">üìã NR35 ‚Äì Trabalho em Altura</button>
<button class="btn" onclick="abrir('nr18')">üèóÔ∏è NR18 ‚Äì Checklist Obra</button>
<button class="btn" onclick="abrir('historico')">üìÇ Hist√≥rico</button>

</section>

<!-- ========================= NR35 COMPLETA ========================= -->
<section id="nr35">
<h2>NR35 ‚Äì Autoriza√ß√£o Trabalho em Altura</h2>

<label>Local:
<input id="local">
</label>

<label>Respons√°vel Empresa:
<input id="empresa">
</label>

<label>Respons√°vel Contratada:
<input id="resp">
</label>

<hr>

<h3>Capacita√ß√£o / Exame / Riscos Gerais</h3>

<table>
<tr><th>Item</th><th>Status</th></tr>
<tr><td>Funcion√°rio treinado?</td><td><select id="g1"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
<tr><td>Exame m√©dico OK?</td><td><select id="g2"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
<tr><td>Risco energizado?</td><td><select id="g3"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
<tr><td>Tempo seco/vento ok?</td><td><select id="g4"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
<tr><td>Queda de objetos?</td><td><select id="g5"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
<tr><td>√Årea isolada?</td><td><select id="g6"><option>Sim</option><option>N√£o</option><option>N/A</option></select></td></tr>
</table>

<hr>

<h3>EPIs Obrigat√≥rios</h3>
<label><input type="checkbox" id="epi1"> Capacete</label>
<label><input type="checkbox" id="epi2"> Cinto 2 talabartes</label>
<label><input type="checkbox" id="epi3"> Trava-quedas</label>
<label><input type="checkbox" id="epi4"> √ìculos</label>
<label><input type="checkbox" id="epi5"> Luvas</label>
<label><input type="checkbox" id="epi6"> Botina biqueira a√ßo</label>

<hr>

<h3>Observa√ß√µes</h3>
<textarea id="obs"></textarea>

<hr>

<h3>Assinaturas dos Trabalhadores (5)</h3>
<div id="assinaturas"></div>

<button class="btn gray" onclick="limparAssinaturas()">üßπ Limpar Assinaturas</button>

<button class="btn save" onclick="salvarNR35()">üíæ Salvar NR35</button>

<button class="btn pdf" onclick="gerarPDF()">üìÑ Gerar PDF NR35</button>

<button class="btn" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<!-- ========================= NR18 ========================= -->
<section id="nr18">
<h2>NR18 ‚Äì Checklist Geral da Obra</h2>

<label><input type="checkbox"> Guarda-corpo instalado</label>
<label><input type="checkbox"> Prote√ß√£o de aberturas</label>
<label><input type="checkbox"> Linha de vida presente</label>
<label><input type="checkbox"> Andaimes regulares</label>
<label><input type="checkbox"> EPIs entregues e registrados</label>
<label><input type="checkbox"> √Årea limpa e organizada</label>
<label><input type="checkbox"> Sinaliza√ß√£o obrigat√≥ria</label>
<label><input type="checkbox"> Treinamentos NR18 realizados</label>

<button class="btn save" onclick="salvarNR18()">üíæ Salvar NR18</button>

<button class="btn" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<!-- ========================= HIST√ìRICO ========================= -->
<section id="historico">
<h2>Hist√≥rico de Registros</h2>
<div id="lista"></div>

<button class="btn gray" onclick="limparHistorico()">üóë Limpar Hist√≥rico</button>
<button class="btn" onclick="abrir('menu')">‚¨Ö Voltar</button>
</section>

<!-- ========================= SCRIPT ========================= -->
<script>
let pads=[];

function abrir(id){
  document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";

  if(id==="nr35"){ carregarAssinaturas(); }
  if(id==="historico"){ carregarHistorico(); }
}

/* ASSINATURAS */
function carregarAssinaturas(){
  const div=document.getElementById("assinaturas");
  div.innerHTML="";
  pads=[];

  for(let i=1;i<=5;i++){
    div.innerHTML+=`
      <h4>Trabalhador ${i}</h4>
      <input id="nome${i}" placeholder="Nome">
      <input id="cpf${i}" placeholder="CPF">
      <canvas id="canvas${i}"></canvas>
      <button class="btn gray" onclick="pads[${i}].clear()">Limpar</button>
      <hr>
    `;
  }

  setTimeout(()=>{
    for(let i=1;i<=5;i++){
      let c=document.getElementById("canvas"+i);
      c.width=c.offsetWidth;
      c.height=150;
      pads[i]=new SignaturePad(c);
    }
  },300);
}

function limparAssinaturas(){
  for(let i=1;i<=5;i++) pads[i].clear();
}

/* SALVAR */
function salvarNR35(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR35",data:new Date().toLocaleString(),local:local.value});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("‚úÖ NR35 salva!");
}

function salvarNR18(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR18",data:new Date().toLocaleString()});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("‚úÖ NR18 salva!");
}

/* HIST√ìRICO */
function carregarHistorico(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  lista.innerHTML=dados.map(r=>`<p><b>${r.tipo}</b> ‚Äì ${r.data}</p>`).join("")
  ||"<p>Nenhum registro ainda.</p>";
}

function limparHistorico(){
  localStorage.removeItem("sst");
  alert("Hist√≥rico apagado!");
  carregarHistorico();
}

/* PDF NR35 */
function gerarPDF(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  doc.text("NR35 ‚Äì Autoriza√ß√£o Trabalho em Altura",10,10);
  doc.text("Local: "+local.value,10,20);
  doc.text("Empresa: "+empresa.value,10,30);

  doc.text("EPIs:",10,45);
  doc.text("Capacete: "+(epi1.checked?"Sim":"N√£o"),10,55);
  doc.text("Cinto: "+(epi2.checked?"Sim":"N√£o"),10,65);

  doc.text("Assinaturas:",10,80);

  let img=pads[1].toDataURL();
  doc.addImage(img,"PNG",10,90,60,30);

  doc.save("NR35-Autorizacao.pdf");
}
</script>

</body>
</html>
