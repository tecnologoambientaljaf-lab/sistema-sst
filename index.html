<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NR35 ‚Äì Autoriza√ß√£o Trabalho em Altura</title>

<!-- ‚úÖ Biblioteca de Assinatura -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f4f6f8;}
header{text-align:center;padding:20px;background:#003366;color:#fff;border-radius:12px;}
h1{margin:0;font-size:22px;}
section{background:#fff;border-radius:12px;padding:15px;margin-top:15px;}

input,select,textarea{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:4px;
}

.btn{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  background:#0059b3;
  color:white;
  font-size:16px;
  font-weight:bold;
}

.save{background:green;}
.small{font-size:12px;color:#444;}

canvas{
  width:100%;
  height:160px;
  border:2px solid black;
  border-radius:10px;
  background:white;
  touch-action:none;
}
</style>
</head>

<body>

<header>
<h1>NR35 ‚Äì AUTORIZA√á√ÉO TRABALHO EM ALTURA</h1>
<p><b>FREIBERGER & FERNANDES ‚Äì Engenharia</b></p>
<p>Padr√£o Fiscaliza√ß√£o Oficial</p>
</header>

<section>

<h2>1. Dados da Obra</h2>

<label>Local:
<input id="local" placeholder="Ex: Col√©gio Adventista">
</label>

<label>Respons√°vel Empresa:
<input id="empresa" placeholder="Ex: Projeto A">
</label>

<label>Respons√°vel Contratada:
<input id="resp" placeholder="Ex: Eng. Jadison / Eng. Luan">
</label>

<hr>

<h2>2. Declara√ß√£o</h2>
<p class="small">
Declaro estar ciente dos riscos e comprometo-me a cumprir todos os itens desta autoriza√ß√£o.
</p>

<hr>

<h2>3. Assinaturas dos Trabalhadores (5)</h2>

<div id="assinaturas"></div>

<button class="btn" style="background:gray;" onclick="limparAssinaturas()">
üßπ Limpar Todas Assinaturas
</button>

<hr>

<label>Liberado por:
<input id="liberado" placeholder="Respons√°vel pela Libera√ß√£o">
</label>

<label>Data:
<input id="data" type="date">
</label>

<button class="btn save" onclick="salvarTudo()">
üíæ Salvar Autoriza√ß√£o Completa
</button>

</section>

<!-- ‚úÖ SCRIPT √öNICO LIMPO -->
<script>
let pads = [];

/* ==========================
   CRIAR 5 CAMPOS DE ASSINATURA
========================== */
function carregarAssinaturas(){
  const container = document.getElementById("assinaturas");
  container.innerHTML = "";

  pads = [];

  for(let i=1;i<=5;i++){

    container.innerHTML += `
      <h3>Trabalhador ${i}</h3>

      <label>Nome:</label>
      <input id="nome${i}" placeholder="Nome completo">

      <label>CPF:</label>
      <input id="cpf${i}" placeholder="CPF">

      <label>Assinatura Digital:</label>
      <canvas id="canvas${i}"></canvas>

      <button class="btn" style="background:#666;" onclick="limparCanvas(${i})">
        Limpar Assinatura ${i}
      </button>

      <hr>
    `;
  }

  setTimeout(()=>{
    for(let i=1;i<=5;i++){
      const canvas = document.getElementById("canvas"+i);

      // Ajustar tamanho real
      canvas.width = canvas.offsetWidth;
      canvas.height = 160;

      pads[i] = new SignaturePad(canvas);
    }
  },300);
}

/* ==========================
   LIMPAR INDIVIDUAL
========================== */
function limparCanvas(i){
  pads[i].clear();
}

/* ==========================
   LIMPAR TODAS
========================== */
function limparAssinaturas(){
  for(let i=1;i<=5;i++){
    pads[i].clear();
  }
}

/* ==========================
   SALVAR DADOS (LOCALSTORAGE)
========================== */
function salvarTudo(){

  let trabalhadores = [];

  for(let i=1;i<=5;i++){
    trabalhadores.push({
      nome: document.getElementById("nome"+i).value,
      cpf: document.getElementById("cpf"+i).value,
      assinatura: pads[i].isEmpty() ? "" : pads[i].toDataURL()
    });
  }

  let registro = {
    tipo: "NR35 Autoriza√ß√£o",
    datahora: new Date().toLocaleString(),
    local: document.getElementById("local").value,
    empresa: document.getElementById("empresa").value,
    responsavel: document.getElementById("resp").value,
    liberado: document.getElementById("liberado").value,
    data: document.getElementById("data").value,
    trabalhadores: trabalhadores
  };

  localStorage.setItem("nr35_registro", JSON.stringify(registro));

  alert("‚úÖ Autoriza√ß√£o NR35 salva com assinaturas!");
}

/* ==========================
   AUTO-INICIAR AO ABRIR
========================== */
window.onload = carregarAssinaturas;
</script>

</body>
</html>
