<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema Ãšnico SST</title>

<!-- âœ… Biblioteca Assinatura -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f4f6f8;}
header{text-align:center;padding:20px;background:#003366;color:#fff;border-radius:12px;}
h1{margin:0;font-size:22px;}

.btn{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  background:#0059b3;
  color:white;
  font-size:16px;
  font-weight:bold;
}

.save{background:green;}
.gray{background:#666;}

section{
  display:none;
  background:#fff;
  border-radius:12px;
  padding:15px;
  margin-top:15px;
}

input,textarea,select{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:1px solid #ccc;
  margin-top:4px;
}

canvas{
  width:100%;
  height:160px;
  border:2px solid black;
  border-radius:10px;
  background:white;
  touch-action:none;
}

.small{font-size:12px;color:#444;}
</style>
</head>

<body>

<header>
<h1>Sistema Ãšnico de SST</h1>
<p><b>FREIBERGER & FERNANDES â€“ Engenharia</b></p>
<p>PadrÃ£o FiscalizaÃ§Ã£o Oficial</p>
</header>

<!-- âœ… MENU PRINCIPAL -->
<section id="menu" style="display:block;">
<h2>Menu Principal</h2>

<button class="btn" onclick="abrir('nr35')">ğŸ“‹ NR35 â€“ Trabalho em Altura</button>
<button class="btn" onclick="abrir('apr')">âš ï¸ APR â€“ AnÃ¡lise Preliminar</button>
<button class="btn" onclick="abrir('nr18')">ğŸ—ï¸ NR18 â€“ Checklist Obra</button>
<button class="btn" onclick="abrir('historico')">ğŸ“‚ HistÃ³rico</button>

</section>

<!-- âœ… NR35 -->
<section id="nr35">
<h2>NR35 â€“ AutorizaÃ§Ã£o Trabalho em Altura</h2>

<label>Local:
<input id="local">
</label>

<label>ResponsÃ¡vel Empresa:
<input id="empresa">
</label>

<label>ResponsÃ¡vel Contratada:
<input id="resp">
</label>

<hr>

<h3>Assinaturas dos Trabalhadores (5)</h3>
<div id="assinaturas"></div>

<button class="btn gray" onclick="limparAssinaturas()">ğŸ§¹ Limpar Assinaturas</button>

<button class="btn save" onclick="salvarNR35()">ğŸ’¾ Salvar NR35</button>

<button class="btn" onclick="abrir('menu')">â¬… Voltar ao Menu</button>
</section>

<!-- âœ… APR -->
<section id="apr">
<h2>APR â€“ AnÃ¡lise Preliminar de Risco</h2>

<textarea id="aprtexto" placeholder="Descreva riscos e medidas de controle..."></textarea>

<button class="btn save" onclick="salvarAPR()">ğŸ’¾ Salvar APR</button>

<button class="btn" onclick="abrir('menu')">â¬… Voltar ao Menu</button>
</section>

<!-- âœ… NR18 -->
<section id="nr18">
<h2>NR18 â€“ Checklist CondiÃ§Ãµes Gerais</h2>

<label><input type="checkbox"> Guarda-corpo instalado</label>
<label><input type="checkbox"> Linha de vida presente</label>
<label><input type="checkbox"> Andaimes adequados</label>
<label><input type="checkbox"> SinalizaÃ§Ã£o completa</label>
<label><input type="checkbox"> EPIs entregues e registrados</label>

<button class="btn save" onclick="salvarNR18()">ğŸ’¾ Salvar NR18</button>

<button class="btn" onclick="abrir('menu')">â¬… Voltar ao Menu</button>
</section>

<!-- âœ… HISTÃ“RICO -->
<section id="historico">
<h2>HistÃ³rico de Registros</h2>
<div id="lista"></div>

<button class="btn gray" onclick="limparHistorico()">ğŸ—‘ Limpar HistÃ³rico</button>

<button class="btn" onclick="abrir('menu')">â¬… Voltar ao Menu</button>
</section>

<!-- âœ… SCRIPT ÃšNICO -->
<script>
let pads = [];

/* =============================
   NAVEGAÃ‡ÃƒO ENTRE TELAS
============================= */
function abrir(id){
  document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";

  if(id==="nr35"){
    carregarAssinaturas();
  }

  if(id==="historico"){
    carregarHistorico();
  }
}

/* =============================
   ASSINATURAS NR35
============================= */
function carregarAssinaturas(){
  const container=document.getElementById("assinaturas");
  container.innerHTML="";
  pads=[];

  for(let i=1;i<=5;i++){
    container.innerHTML += `
      <h4>Trabalhador ${i}</h4>
      <input id="nome${i}" placeholder="Nome">
      <input id="cpf${i}" placeholder="CPF">
      <canvas id="canvas${i}"></canvas>
      <button class="btn gray" onclick="limparCanvas(${i})">Limpar ${i}</button>
      <hr>
    `;
  }

  setTimeout(()=>{
    for(let i=1;i<=5;i++){
      let canvas=document.getElementById("canvas"+i);
      canvas.width=canvas.offsetWidth;
      canvas.height=160;
      pads[i]=new SignaturePad(canvas);
    }
  },300);
}

function limparCanvas(i){ pads[i].clear(); }
function limparAssinaturas(){
  for(let i=1;i<=5;i++) pads[i].clear();
}

/* =============================
   SALVAR REGISTROS
============================= */
function salvarNR35(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");

  dados.push({
    tipo:"NR35",
    data:new Date().toLocaleString(),
    local:local.value,
    empresa:empresa.value
  });

  localStorage.setItem("sst",JSON.stringify(dados));
  alert("âœ… NR35 salva!");
}

function salvarAPR(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");

  dados.push({
    tipo:"APR",
    data:new Date().toLocaleString(),
    texto:aprtexto.value
  });

  localStorage.setItem("sst",JSON.stringify(dados));
  alert("âœ… APR salva!");
}

function salvarNR18(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");

  dados.push({
    tipo:"NR18",
    data:new Date().toLocaleString()
  });

  localStorage.setItem("sst",JSON.stringify(dados));
  alert("âœ… NR18 salva!");
}

/* =============================
   HISTÃ“RICO
============================= */
function carregarHistorico(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  let html="";

  dados.forEach(r=>{
    html += `<p><b>${r.tipo}</b> â€“ ${r.data}</p>`;
  });

  lista.innerHTML = html || "<p>Nenhum registro ainda.</p>";
}

function limparHistorico(){
  localStorage.removeItem("sst");
  alert("HistÃ³rico apagado!");
  carregarHistorico();
}
</script>

</body>
</html>
