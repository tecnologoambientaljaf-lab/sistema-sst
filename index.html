<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema SST Profissional</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;margin:0;padding:15px;background:#f4f6f8;}
header{text-align:center;padding:20px;background:#003366;color:#fff;border-radius:12px;}
h1{margin:0;font-size:22px;}

.btn{
  width:100%;padding:14px;margin:10px 0;
  border:none;border-radius:12px;
  background:#0059b3;color:white;
  font-size:16px;font-weight:bold;
}
.save{background:green;}
.pdf{background:darkred;}
.whats{background:#25D366;}
.back{background:gray;}

section{
  display:none;
  background:white;
  padding:15px;
  margin-top:15px;
  border-radius:12px;
}

input,textarea,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-top:6px;
}

canvas{
  width:100%;
  height:140px;
  border:2px solid black;
  border-radius:10px;
  background:white;
  touch-action:none;
}

hr{margin:20px 0;}
small{color:#444;}
</style>
</head>

<body>

<header>
<h1>Sistema Ãšnico SST</h1>
<p><b>FREIBERGER & FERNANDES â€“ Engenharia</b></p>
<p>PadrÃ£o FiscalizaÃ§Ã£o Oficial</p>
</header>

<!-- MENU -->
<section id="menu" style="display:block;">
<button class="btn" onclick="abrir('nr35')">ğŸ“‹ NR35 â€“ Trabalho em Altura</button>
<button class="btn" onclick="abrir('nr18')">ğŸ¦º NR18 â€“ Checklist Obra</button>
<button class="btn" onclick="abrir('historico')">ğŸ“‚ HistÃ³rico</button>
</section>

<!-- NR35 -->
<section id="nr35">
<h2>ğŸ“‹ NR35 â€“ AutorizaÃ§Ã£o Trabalho em Altura</h2>

<label>Local da Obra:</label>
<input id="local35">

<label>ResponsÃ¡vel Empresa:</label>
<input id="empresa35">

<label>Engenheiro ResponsÃ¡vel:</label>
<input id="eng35" value="Eng. Jadison Fernandes">

<hr>

<h3>Trabalhadores (5)</h3>
<div id="listaTrabalhadores"></div>

<button class="btn save" onclick="salvarNR35()">ğŸ’¾ Salvar NR35</button>
<button class="btn pdf" onclick="gerarPDF_NR35()">ğŸ“„ Gerar PDF Oficial NR35</button>
<button class="btn whats" onclick="enviarWhats()">ğŸ“² Enviar WhatsApp Engenheiro</button>
<button class="btn back" onclick="abrir('menu')">â¬… Voltar</button>
</section>

<!-- NR18 -->
<section id="nr18">
<h2>ğŸ¦º NR18 â€“ Checklist FiscalizaÃ§Ã£o</h2>

<label>Obra:</label>
<input id="obra18">

<label>ResponsÃ¡vel:</label>
<input id="resp18">

<hr>

<h3>EPI</h3>
<label>Capacete:
<select id="epi1"><option>SIM</option><option>NÃƒO</option></select></label>

<label>Botina:
<select id="epi2"><option>SIM</option><option>NÃƒO</option></select></label>

<label>Luvas:
<select id="epi3"><option>SIM</option><option>NÃƒO</option></select></label>

<label>Ã“culos:
<select id="epi4"><option>SIM</option><option>NÃƒO</option></select></label>

<hr>

<h3>EPC</h3>
<label>Guarda-corpos:
<select id="epc1"><option>SIM</option><option>NÃƒO</option></select></label>

<label>ProteÃ§Ã£o em aberturas:
<select id="epc2"><option>SIM</option><option>NÃƒO</option></select></label>

<hr>

<h3>SinalizaÃ§Ã£o</h3>
<label>Placas obrigatÃ³rias:
<select id="sig1"><option>SIM</option><option>NÃƒO</option></select></label>

<label>Ãreas isoladas:
<select id="sig2"><option>SIM</option><option>NÃƒO</option></select></label>

<hr>

<h3>ConclusÃ£o</h3>
<textarea id="obs18" placeholder="ObservaÃ§Ãµes"></textarea>

<button class="btn save" onclick="salvarNR18()">ğŸ’¾ Salvar NR18</button>
<button class="btn pdf" onclick="gerarPDF_NR18()">ğŸ“„ Gerar PDF Oficial NR18</button>
<button class="btn back" onclick="abrir('menu')">â¬… Voltar</button>
</section>

<!-- HISTÃ“RICO -->
<section id="historico">
<h2>ğŸ“‚ HistÃ³rico</h2>
<div id="lista"></div>
<button class="btn back" onclick="abrir('menu')">â¬… Voltar</button>
</section>

<script>
let pads=[];

/* MENU */
function abrir(id){
  document.querySelectorAll("section").forEach(sec=>sec.style.display="none");
  document.getElementById(id).style.display="block";

  if(id==="nr35") carregarTrabalhadores();
  if(id==="historico") carregarHistorico();
}

/* GERAR 5 TRABALHADORES */
function carregarTrabalhadores(){
  let div=document.getElementById("listaTrabalhadores");
  div.innerHTML="";
  pads=[];

  for(let i=1;i<=5;i++){
    div.innerHTML+=`
      <h4>Trabalhador ${i}</h4>
      <input id="nome${i}" placeholder="Nome completo">
      <input id="cpf${i}" placeholder="CPF obrigatÃ³rio">
      <canvas id="canvas${i}"></canvas>
      <button class="btn back" onclick="limparCanvas(${i})">Limpar Assinatura</button>
      <hr>
    `;
  }

  setTimeout(()=>{
    for(let i=1;i<=5;i++){
      let canvas=document.getElementById("canvas"+i);
      canvas.width=canvas.offsetWidth;
      canvas.height=140;
      iniciarAssinatura(canvas,i);
    }
  },300);
}

/* ASSINATURA */
function iniciarAssinatura(canvas,i){
  let ctx=canvas.getContext("2d");
  let desenhando=false;

  canvas.addEventListener("pointerdown",e=>{
    desenhando=true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX,e.offsetY);
  });

  canvas.addEventListener("pointermove",e=>{
    if(!desenhando) return;
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
  });

  canvas.addEventListener("pointerup",()=>desenhando=false);

  pads[i]={canvas,ctx};
}

function limparCanvas(i){
  let p=pads[i];
  p.ctx.clearRect(0,0,p.canvas.width,p.canvas.height);
}

/* SALVAR */
function salvarNR35(){
  for(let i=1;i<=5;i++){
    if(document.getElementById("cpf"+i).value.trim()===""){
      alert("âš ï¸ CPF obrigatÃ³rio no trabalhador "+i);
      return;
    }
  }

  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR35",data:new Date().toLocaleString()});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("âœ… NR35 salva com sucesso!");
}

function salvarNR18(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  dados.push({tipo:"NR18",data:new Date().toLocaleString()});
  localStorage.setItem("sst",JSON.stringify(dados));
  alert("âœ… NR18 salva com sucesso!");
}

/* HISTÃ“RICO */
function carregarHistorico(){
  let dados=JSON.parse(localStorage.getItem("sst")||"[]");
  lista.innerHTML=dados.map(r=>`<p>âœ… ${r.tipo} â€“ ${r.data}</p>`).join("");
}

/* PDF NR35 */
function gerarPDF_NR35(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  doc.text("NR35 â€“ AutorizaÃ§Ã£o Trabalho em Altura",10,10);
  doc.text("Local: "+local35.value,10,20);

  let y=35;
  for(let i=1;i<=5;i++){
    doc.text("Trabalhador "+i+": "+document.getElementById("nome"+i).value,10,y);
    doc.text("CPF: "+document.getElementById("cpf"+i).value,10,y+7);

    let img=pads[i].canvas.toDataURL("image/png");
    doc.addImage(img,"PNG",10,y+12,60,20);

    y+=40;
  }

  doc.save("NR35_Oficial.pdf");
}

/* PDF NR18 */
function gerarPDF_NR18(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  doc.text("NR18 â€“ Checklist FiscalizaÃ§Ã£o",10,10);
  doc.text("Obra: "+obra18.value,10,20);

  doc.text("Capacete: "+epi1.value,10,35);
  doc.text("Botina: "+epi2.value,10,45);
  doc.text("Guarda-corpos: "+epc1.value,10,55);

  doc.text("ObservaÃ§Ãµes:",10,70);
  doc.text(obs18.value,10,80);

  doc.save("NR18_Oficial.pdf");
}

/* WHATSAPP */
function enviarWhats(){
  let msg="NR35 preenchida â€“ Local: "+local35.value;
  window.open("https://wa.me/5547988837699?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
